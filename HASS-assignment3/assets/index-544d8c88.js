(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const t of a.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&s(t)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const g=26,D=10;var x,K,f,v,w,h=0,k=!1;const U=150,y={top:16,right:6,bottom:6,left:0},P=48,z=y.top+P*g+y.bottom,b=1800,p=d3.scaleBand().domain(d3.range(g+1)).rangeRound([y.top,y.top+P*(g+1+.1)]).padding(.1),d=d3.scaleLinear([0,1],[y.left,b-y.right]),X=async n=>await d3.csv(n,d3.autoType),Z=n=>new Set(n.map(e=>e.name)),tt=n=>new Set(n.map(e=>e.category)),et=n=>Array.from(d3.rollup(n,([e])=>e.value,e=>+e.date,e=>e.name)).map(([e,r])=>[new Date(e),r]).sort(([e],[r])=>d3.ascending(e,r)),I=n=>{const e=Array.from(K,r=>({name:r,value:n(r)}));e.sort((r,s)=>d3.descending(r.value,s.value));for(let r=0;r<e.length;++r)e[r].rank=Math.min(g,r);return e},at=n=>{const e=[];let r,s,o,a;for([[r,s],[o,a]]of d3.pairs(n))for(let t=0;t<D;++t){const i=t/D;e.push([new Date(r*(1-i)+o*i),I(l=>(s.get(l)||0)*(1-i)+(a.get(l)||0)*i)])}return e.push([new Date(o),I(t=>a.get(t)||0)]),e},nt=n=>d3.groups(n.flatMap(([,e])=>e),e=>e.name),rt=n=>{const e=new Map(n.flatMap(([,s])=>d3.pairs(s,(o,a)=>[a,o]))),r=new Map(n.flatMap(([,s])=>d3.pairs(s)));return[e,r]},ot=()=>{const n=d3.scaleOrdinal(d3.schemeTableau10);if(x.some(e=>e.category!==void 0)){const e=new Map(x.map(r=>[r.name,r.category]));return n.domain(Array.from(e.values())),r=>n(e.get(r.name))}return e=>n(e.name)},st=n=>{let e=n.append("g").attr("fill-opacity",.6).selectAll("rect");return([r,s],o)=>e=e.data(s.slice(0,g),a=>a.name).join(a=>a.append("rect").attr("fill",ot()).attr("height",p.bandwidth()).attr("x",d(0)).attr("y",t=>p((v.get(t)||t).rank)).attr("width",t=>d((v.get(t)||t).value)-d(0)),a=>a,a=>a.transition(o).remove().attr("y",t=>p((w.get(t)||t).rank)).attr("width",t=>d((w.get(t)||t).value)-d(0))).call(a=>a.transition(o).attr("y",t=>p(t.rank)).attr("width",t=>d(t.value)-d(0)))},j=(n,e)=>{const r=d3.interpolateNumber(n,e);return function(s){this.textContent=d3.format(",d")(r(s))}},it=n=>{let e=n.append("g").style("font","bold 12px var(--sans-serif)").style("font-variant-numeric","tabular-nums").attr("text-anchor","end").selectAll("text");return([r,s],o)=>e=e.data(s.slice(0,g),a=>a.name).join(a=>a.append("text").attr("transform",t=>`translate(${d((v.get(t)||t).value)},${p((v.get(t)||t).rank)})`).attr("y",p.bandwidth()/2).attr("x",-6).attr("dy","-0.25em").text(t=>t.name).call(t=>t.append("tspan").attr("fill-opacity",.7).attr("font-weight","normal").attr("x",-6).attr("dy","1.15em")),a=>a,a=>a.transition(o).remove().attr("transform",t=>`translate(${d((w.get(t)||t).value)},${p((w.get(t)||t).rank)})`).call(t=>t.select("tspan").tween("text",i=>j(i.value,(w.get(i)||i).value)))).call(a=>a.transition(o).attr("transform",t=>`translate(${d(t.value)},${p(t.rank)})`).attr("id","labelOnBar").call(t=>t.select("tspan").tween("text",i=>j((v.get(i)||i).value,i.value))))},ct=n=>{const e=n.append("g").attr("transform",`translate(0,${y.top})`),r=d3.axisTop(d).ticks(b/160).tickSizeOuter(0).tickSizeInner(-P*(g+p.padding()));return(s,o)=>{e.transition(o).call(r),e.select(".tick:first-of-type text").remove(),e.selectAll(".tick:not(:first-of-type) line").attr("stroke","#242424"),e.select(".domain").remove()}},R=d3.utcFormat("%B %Y"),lt=n=>{const e=n.append("text").attr("text-anchor","end").attr("x",b-6).attr("y",y.top+P*(g-.45)).attr("dy","0.32em").attr("id","timeLabel").style("font-size","2.5em").style("font-weight","bold").style("fill","white").text(R(f[0][0]));return([r],s)=>{s.end().then(()=>e.text(R(r)))}};async function V(n,e,r,s,o,a,t){const i=f[t];h=t/f.length,a();const l=n.transition().duration(U).ease(d3.easeLinear);d.domain([0,i[1][0].value]),e(i,l),r(i,l),s(i,l),o(i,l),await l.end()}async function dt(n,e,r,s,o,a,t){t<=.001&&(t=0),t>=.995&&(t=1);var i;t===1?i=f.length-1:t===0?i=0:i=Math.floor(t*f.length),V(n,e,r,s,o,a,i)}async function E(n,e,r,s,o,a,t){t<=.001&&(t=0),t>=.995&&(t=1);const i=Math.floor(t*f.length);for(let l=i;l<f.length&&(await V(n,e,r,s,o,a,l),!k);l++);}async function ut(){const n=" Play ",e="Pause",r=d3.select("#control").append("button").attr("id","playButton").text(e).style("margin","20px").style("min-width","100px").on("click",function(){this.textContent===n?(this.textContent=e,k=!1,E(m,O,T,L,$,M,h)):(this.textContent=n,k=!0)}),s=800,o=22,a=o/2-2,t=a+2,i=s-t,l=i-t;var N=d3.select("#control").append("svg").attr("width",s).attr("height",o),A=N.append("rect").attr("width",t).attr("height",8).attr("x",0).attr("y",o/2-4).attr("rx",4).attr("fill","#45b69c"),B=N.append("circle").attr("r",a).attr("cx",t).attr("cy",o/2).attr("fill","#21d19f").style("cursor","pointer").call(d3.drag().on("drag",H).on("end",W)).on("mouseover",function(){d3.select(this).attr("r",a+2)}).on("mouseout",function(){d3.select(this).attr("r",a)});const q=c=>c*l+t,G=c=>(c-t)/l,F=c=>Math.max(t,Math.min(i,c));function H(c){const u=F(c.x);B.attr("cx",u),A.attr("width",u),k=!0,r.text(n)}function W(c){const u=F(c.x);B.attr("cx",u),A.attr("width",u),h=G(u),console.log("playProgress: ",(h*100).toFixed(2)+"%"),dt(m,O,T,L,$,M,h)}const M=()=>{const c=q(h);B.attr("cx",c),A.attr("width",c)};x=await X("data.csv"),K=Z(x);const C=tt(x),Y=et(x);f=at(Y);const _=nt(f);[v,w]=rt(_);const m=d3.select("#chart").append("svg").attr("viewBox",[0,0,b,z]),T=st(m),L=it(m),O=ct(m),$=lt(m),J=m.append("g").attr("transform",`translate(${b-100}, ${z-100})`),Q=c=>{const u=d3.scaleOrdinal(d3.schemeTableau10);return u.domain(Array.from(C)),u(c)},S=J.selectAll("g").data(C).join("g").attr("transform",(c,u)=>`translate(-10, ${u*20})`);S.append("rect").attr("x",0).attr("y",-60).attr("width",10).attr("height",10).attr("fill",c=>Q(c)),S.append("text").attr("x",20).attr("y",-56).attr("dy","0.32em").text(c=>c).style("fill","grey").style("font-size","1em").style("font-weight","regular"),await E(m,O,T,L,$,M,0)}ut();
